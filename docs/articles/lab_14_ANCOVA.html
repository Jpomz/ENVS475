<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lab 14: ANCOVA • ENVS475</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Lab 14: ANCOVA">
<meta property="og:description" content="ENVS475">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ENVS475</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2024.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/syllabus.html">
    <span class="fa fa-book"></span>
     
    Syllabus
  </a>
</li>
<li>
  <a href="../articles/schedule.html">
    <span class="fa fa-calendar"></span>
     
    Schedule
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-desktop"></span>
     
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/lectures/lecture_00/lecture_00_course_overview.html">Lecture 0: Course introduction</a>
    </li>
    <li>
      <a href="../articles/lectures/lecture_03_basic-stats/lecture_03_basic-stats.html">Lecture 03: Basic Statistics</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-laptop-code"></span>
     
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/lab_01_projects.html">lab_01_projects</a>
    </li>
    <li>
      <a href="../articles/lab_02_intro_to_R.html">lab_02_intro_to_R</a>
    </li>
    <li>
      <a href="../articles/lab_03_normal-distributions.html">lab 03: Normal Distributions</a>
    </li>
    <li>
      <a href="../articles/lab_04a_dplyr.html">lab 04a: dplyr</a>
    </li>
    <li>
      <a href="../articles/lab_04b_ggplot.html">lab_04b_ggplot</a>
    </li>
    <li>
      <a href="../articles/lab_05_point-estimates.html">lab_05_point-estimates</a>
    </li>
    <li>
      <a href="../articles/lab_06_linear-models.html">lab_06_linear-models</a>
    </li>
    <li>
      <a href="../articles/lab_07_intro_markdown.html">lab_07_intro_markdown</a>
    </li>
    <li>
      <a href="../articles/lab_08_t-tests.html">lab_08_t-tests</a>
    </li>
    <li>
      <a href="../articles/lab_10_anova.html">lab_10_anova</a>
    </li>
    <li>
      <a href="../articles/lab_11_factorial-anova.html">lab_11_factorial-anova</a>
    </li>
    <li>
      <a href="../articles/lab_12_2-way-anova.html">lab_12_2-way-anova</a>
    </li>
    <li>
      <a href="../articles/lab_13_linear-regression.html">lab_13_linear-regression</a>
    </li>
    <li>
      <a href="../articles/lab_14_ANCOVA.html">lab_14_ANCOVA</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-folder-open"></span>
     
    Homework
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/homework/HW_01.html">Homework 01 setup</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-pencil-square-o"></span>
     
    References
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/term-list.html">Terms and Definitions</a>
    </li>
  </ul>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Lab 14: ANCOVA</h1>
            <h3 data-toc-skip class="subtitle">ENVS475: Experimental
Analysis and Design</h3>
            
            <h4 data-toc-skip class="date">Spring, 2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Jpomz/ENVS475/blob/HEAD/vignettes/articles/lab_14_ANCOVA.Rmd" class="external-link"><code>vignettes/articles/lab_14_ANCOVA.Rmd</code></a></small>
      <div class="hidden name"><code>lab_14_ANCOVA.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="about">About<a class="anchor" aria-label="anchor" href="#about"></a>
</h2>
<p>Here we go for our final linear-model example. It is unique in that
it combines a categorical explanatory variable with a continuous
explanatory variable. What are we up to? We are combining regression and
one-way ANOVA! Yes we are.</p>
</div>
<div class="section level2">
<h2 id="ancova">ANCOVA<a class="anchor" aria-label="anchor" href="#ancova"></a>
</h2>
<p>This week, we will be using the <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> function to fit a
linear regression to data which has a continuous <em>AND</em> a
categorical variable. Essentially, we will be fitting two linear
regression models (one for each level of the categorical variable), and
testing whether these lines are different from each other or not.</p>
<div class="section level3">
<h3 id="preliminaries">Preliminaries<a class="anchor" aria-label="anchor" href="#preliminaries"></a>
</h3>
<div class="section level4">
<h4 id="packages">Packages<a class="anchor" aria-label="anchor" href="#packages"></a>
</h4>
<p>For this lab, we will be using the <code>dplyr</code>,
<code>ggplot2</code>, and <code>Sleuth3</code> packages. Make sure all
packages are installed on your computer (you may need to install
<code>Sleuth3</code>), and then run the following code:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-forge.r-project.org/projects/sleuth2/" class="external-link">Sleuth3</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="hypotheses-plain-words">Hypotheses, plain words<a class="anchor" aria-label="anchor" href="#hypotheses-plain-words"></a>
</h3>
<ul>
<li>Is the intercept for the reference level = 0?<br>
</li>
<li>Is there a <em>difference</em> in intercepts between the groups
(Think ANOVA)<br>
</li>
<li>Is there a relationship between the response and continuous
predictor variable <em>regardless</em> of groups? (Think a “global”
linear regression, ignoring/averaging across groups)<br>
</li>
<li>Does the relationship between the response and continous predictor
<em>differ</em> between groups? i.e., are the slopes different?</li>
</ul>
</div>
<div class="section level3">
<h3 id="hypotheses-graphs">Hypotheses, graphs<a class="anchor" aria-label="anchor" href="#hypotheses-graphs"></a>
</h3>
<pre><code><span><span class="co">## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">## <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">## <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">## <span style="color: #555555;">generated.</span></span></span></code></pre>
<p><img src="lab_14_ANCOVA_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p><img src="lab_14_ANCOVA_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p><img src="lab_14_ANCOVA_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p><img src="lab_14_ANCOVA_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p><img src="lab_14_ANCOVA_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="parameters-two-linear-equations">Parameters, two linear equations<a class="anchor" aria-label="anchor" href="#parameters-two-linear-equations"></a>
</h3>
<p>Equation for the line of the reference (REF) level</p>
<p><span class="math display">\[\hat{y}_{REF} = \beta_0 +
\beta_1*x_1\]</span></p>
<p>Equation for the line of the alternative (ALT) level</p>
<p><span class="math display">\[\hat{y}_{ALT} = (\beta_0
+\beta_{0\Delta}) + (\beta_1 +\beta_{1\Delta})*x_1\]</span></p>
<ul>
<li><p><span class="math inline">\(\Delta\)</span> is the Greek letter
Delta, and is commonly used to represent <em>differences</em></p></li>
<li><p><span class="math inline">\(\beta_0\)</span> = intercept for
reference level</p></li>
<li><p><span class="math inline">\((\beta_{0\Delta})\)</span> =
Difference between intercepts</p></li>
<li><p><span class="math inline">\(\beta_1\)</span> = Slope for
reference level</p></li>
<li><p><span class="math inline">\((\beta_{1\Delta})\)</span> =
Difference between slopes (Interactive effect)</p></li>
</ul>
<p><strong>NOTE</strong> We are keeping things simple with just two
levels of the categorical variable. For each additional level, <span class="math inline">\(i\)</span>, there will be two more parameters
estimated in the linear model, one each for the difference in intercepts
between the reference level and level <span class="math inline">\(i\)</span> (<span class="math inline">\(\beta_{0\Delta_i}\)</span>, and one for the
difference in slopes between the reference level and level <span class="math inline">\(i\)</span> (<span class="math inline">\(\beta_{1\Delta_i}\)</span>.</p>
</div>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>We will be using a data set from the <code>Sleuth3</code> package
called <code>case1402</code> . This is data from an experiment examining
the yield of different soybean varieties under different conditions of
Ozone, SO2 and drought. See <code><a href="https://rdrr.io/pkg/Sleuth3/man/case1402.html" class="external-link">?case1402</a></code> for more
information.</p>
</div>
<div class="section level3">
<h3 id="load-data-and-rename-object">Load data and rename object<a class="anchor" aria-label="anchor" href="#load-data-and-rename-object"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">case1402</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         Stress  SO2   O3 Forrest William</span></span>
<span><span class="co">## 1 Well-watered 0.00 0.02    4376    5561</span></span>
<span><span class="co">## 2 Well-watered 0.00 0.05    4544    5947</span></span>
<span><span class="co">## 3 Well-watered 0.00 0.07    2806    4273</span></span>
<span><span class="co">## 4 Well-watered 0.00 0.08    3339    3470</span></span>
<span><span class="co">## 5 Well-watered 0.00 0.10    3320    3080</span></span>
<span><span class="co">## 6 Well-watered 0.02 0.02    3747    5092</span></span></code></pre>
<ul>
<li>
<code>William</code>: Response variable, continuous, needs to be
<code><a href="https://rdrr.io/r/base/Log.html" class="external-link">log()</a></code> transformed<br>
</li>
<li>
<code>O3</code>: Predictor variable, continuous<br>
</li>
<li>
<code>Stress</code>: Predictor variable, categorical/factor
<ul>
<li>Levels: <code>Stressed</code>, <code>Well-watered</code>
</li>
</ul>
</li>
</ul>
<div class="section level4">
<h4 id="transform-william-variable">Transform <code>William</code> variable<a class="anchor" aria-label="anchor" href="#transform-william-variable"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>log_william <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">William</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="plot-data">Plot data<a class="anchor" aria-label="anchor" href="#plot-data"></a>
</h2>
<p>Scatterplot with continuous <em>x</em>- and <em>y</em>-variables.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">O3</span>, </span>
<span>           y <span class="op">=</span> <span class="va">log_william</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab_14_ANCOVA_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">O3</span>, </span>
<span>           y <span class="op">=</span> <span class="va">log_william</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre>
<p><img src="lab_14_ANCOVA_files/figure-html/unnamed-chunk-11-1.png" width="700">
### Factor</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">log_william</span>, </span>
<span>           x <span class="op">=</span> <span class="va">Stress</span>,</span>
<span>           color <span class="op">=</span> <span class="va">Stress</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitter.html" class="external-link">position_jitter</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.1</span>, height <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab_14_ANCOVA_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<div class="section level4">
<h4 id="plot-both-predictor-variables">Plot both predictor variables<a class="anchor" aria-label="anchor" href="#plot-both-predictor-variables"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">O3</span>, </span>
<span>           y <span class="op">=</span> <span class="va">log_william</span>,</span>
<span>           color <span class="op">=</span> <span class="va">Stress</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab_14_ANCOVA_files/figure-html/unnamed-chunk-13-1.png" width="700">
#### With <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth()</a></code></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">O3</span>, </span>
<span>           y <span class="op">=</span> <span class="va">log_william</span>,</span>
<span>           color <span class="op">=</span> <span class="va">Stress</span>,</span>
<span>           fill <span class="op">=</span> <span class="va">Stress</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `geom_smooth()` using formula = 'y ~ x'</span></span></code></pre>
<p><img src="lab_14_ANCOVA_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="fit-ancova-model">Fit ANCOVA model<a class="anchor" aria-label="anchor" href="#fit-ancova-model"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">log_william</span> <span class="op">~</span> <span class="va">O3</span> <span class="op">*</span> <span class="va">Stress</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="assumptions">Assumptions<a class="anchor" aria-label="anchor" href="#assumptions"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">log_william</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html" class="external-link">stat_qq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html" class="external-link">stat_qq_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab_14_ANCOVA_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df_lm</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span> x <span class="op">=</span> <span class="va">.fitted</span>, </span>
<span>            y <span class="op">=</span> <span class="va">.resid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab_14_ANCOVA_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="anova-table">ANOVA table<a class="anchor" aria-label="anchor" href="#anova-table"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">df_lm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Analysis of Variance Table</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Response: log_william</span></span>
<span><span class="co">##           Df  Sum Sq Mean Sq F value    Pr(&gt;F)    </span></span>
<span><span class="co">## O3         1 1.13812 1.13812 51.9277 1.185e-07 ***</span></span>
<span><span class="co">## Stress     1 0.23764 0.23764 10.8426  0.002859 ** </span></span>
<span><span class="co">## O3:Stress  1 0.01013 0.01013  0.4621  0.502639    </span></span>
<span><span class="co">## Residuals 26 0.56985 0.02192                      </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre>
<p><strong>Interpretation</strong>: There is a significant main effect
of <code>O3</code> (<span class="math inline">\(F_{1, 26} =
51.92\)</span>, <span class="math inline">\(p &lt; 0.001\)</span>) and a
significant main effect of <code>Stress</code> (<span class="math inline">\(F_{1, 26} = 10.84\)</span>, <span class="math inline">\(p = 0.002\)</span>). There was no significant
interactive effect (<span class="math inline">\(F_{1, 26} =
0.46\)</span>, <span class="math inline">\(p = 0.5\)</span>).</p>
<p>Plain words: There was a relationship between yield (
<code>log_william</code> ) and <code>O3</code> (continuous predictor
variable). Likewise, there was a difference in average yield based on
the <code>Stress</code> factor (categorical predictor variable,
different intercepts for each group). The relationship between yield and
ozone was not dependent on the stress factor, and vice versa (both
groups had the same slope).</p>
</div>
<div class="section level3">
<h3 id="linear-model-summary">Linear model summary<a class="anchor" aria-label="anchor" href="#linear-model-summary"></a>
</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">df_lm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = log_william ~ O3 * Stress, data = df)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">## -0.24461 -0.13302  0.02398  0.10615  0.32690 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                       Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)             8.4902     0.0975  87.083  &lt; 2e-16 ***</span></span>
<span><span class="co">## O3                     -6.4672     1.4014  -4.615 9.29e-05 ***</span></span>
<span><span class="co">## StressWell-watered      0.2642     0.1379   1.916   0.0664 .  </span></span>
<span><span class="co">## O3:StressWell-watered  -1.3473     1.9819  -0.680   0.5026    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.148 on 26 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.7086, Adjusted R-squared:  0.675 </span></span>
<span><span class="co">## F-statistic: 21.08 on 3 and 26 DF,  p-value: 3.899e-07</span></span></code></pre>
<div class="section level4">
<h4 id="equation-for-line-1-stressed">Equation for line 1: <code>Stressed</code><a class="anchor" aria-label="anchor" href="#equation-for-line-1-stressed"></a>
</h4>
<p><span class="math display">\[Yield_{Stressed} = \beta_0 + \beta_1 *
\text{Ozone} \]</span></p>
<ul>
<li><p>(Intercept) <span class="math inline">\(\beta_0\)</span>:
Estimate = 8.49; This is the average yield for the <code>Stressed</code>
treatment when Ozone = 0.</p></li>
<li><p><code>O3</code> <span class="math inline">\(\beta_1\)</span>:
Estimate = -6.47; For every 1-unit increase in Ozone, the average yield
changes by -6.47.<br>
#### Full equation</p></li>
</ul>
<p><span class="math display">\[ \text{Yield}_{Stressed} = 8.49 - 6.47 *
\text{Ozone}\]</span></p>
</div>
<div class="section level4">
<h4 id="equation-for-line-2-well-watered">Equation for line 2: <code>Well-watered</code><a class="anchor" aria-label="anchor" href="#equation-for-line-2-well-watered"></a>
</h4>
<p><span class="math display">\[Yield_{well-watered} = (\beta_0+\beta_{0
\Delta}) + (\beta_1 +\beta_{1 \Delta}) * \text{Ozone} \]</span></p>
<ul>
<li><p><code>StressWell-watered</code>: This is the estimated difference
(<span class="math inline">\(\beta_0+\beta_{0 \Delta}\)</span>) in
intercepts for the two treatment groups. Estimate = <span class="math inline">\(\beta_0 + \beta_{well-watered} = 8.49 + 0.2642 =
8.75\)</span>; This is the average yield for the
<code>Well-watered</code> treatment when Ozone = 0.</p></li>
<li><p><code>O3:Stresswell-watered</code>: This is the estimated
difference (<span class="math inline">\(\beta_1 +\beta_{1
\Delta}\)</span>) in slopes for the two treatment groups (but note that
the p-value &gt; 0.05, so we fail to reject the NULL that this
coefficient is 0). Estimate = <span class="math inline">\(-6.47 - 1.35 =
-7.82\)</span>.</p></li>
</ul>
<p><span class="math display">\[ \text{Yield}_{well-watered} = (8.49 +
0.2642) - (6.47 - 1.35) * \text{Ozone} = 8.75 - 7.82 *
\text{Ozone}\]</span></p>
<p>Note that these equations will be slightly different from what
<code>geom_smooth(method = "lm")</code> will estimate. To see how to
plot the estimated model fits in <code>ggplot</code>, see the appendix
of this lab.</p>
</div>
</div>
<div class="section level3">
<h3 id="coda">Coda<a class="anchor" aria-label="anchor" href="#coda"></a>
</h3>
<p>This concludes lab 08</p>
</div>
</div>
<div class="section level2">
<h2 id="appendix-plotting-model-estimates">Appendix: Plotting model estimates<a class="anchor" aria-label="anchor" href="#appendix-plotting-model-estimates"></a>
</h2>
<ul>
<li>Make a new data frame with values of predictor variables</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>  O3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">O3</span><span class="op">)</span>,</span>
<span>           to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">O3</span><span class="op">)</span>, </span>
<span>                    length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>  Stress <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Stress</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">new_x</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           O3   Stress</span></span>
<span><span class="co">## 1 0.02000000 Stressed</span></span>
<span><span class="co">## 2 0.02888889 Stressed</span></span>
<span><span class="co">## 3 0.03777778 Stressed</span></span>
<span><span class="co">## 4 0.04666667 Stressed</span></span>
<span><span class="co">## 5 0.05555556 Stressed</span></span>
<span><span class="co">## 6 0.06444444 Stressed</span></span></code></pre>
<ul>
<li>Predict values of y based on model fit (<code>df_lm</code>) and
<code>new_x</code>
</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">new_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">df_lm</span>, </span>
<span>                 newdata <span class="op">=</span> <span class="va">new_x</span>,</span>
<span>                 interval <span class="op">=</span> <span class="st">"confidence"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">new_y</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        fit      lwr      upr</span></span>
<span><span class="co">## 1 8.360886 8.211760 8.510013</span></span>
<span><span class="co">## 2 8.303401 8.175325 8.431476</span></span>
<span><span class="co">## 3 8.245915 8.136922 8.354908</span></span>
<span><span class="co">## 4 8.188429 8.095333 8.281524</span></span>
<span><span class="co">## 5 8.130943 8.048691 8.213195</span></span>
<span><span class="co">## 6 8.073457 7.994874 8.152041</span></span></code></pre>
<ul>
<li>combine <code>new_x</code> and <code>new_y</code> in a data frame to
add to the plot</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">new_x</span>,</span>
<span>                       <span class="va">new_y</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fit_data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           O3   Stress      fit      lwr      upr</span></span>
<span><span class="co">## 1 0.02000000 Stressed 8.360886 8.211760 8.510013</span></span>
<span><span class="co">## 2 0.02888889 Stressed 8.303401 8.175325 8.431476</span></span>
<span><span class="co">## 3 0.03777778 Stressed 8.245915 8.136922 8.354908</span></span>
<span><span class="co">## 4 0.04666667 Stressed 8.188429 8.095333 8.281524</span></span>
<span><span class="co">## 5 0.05555556 Stressed 8.130943 8.048691 8.213195</span></span>
<span><span class="co">## 6 0.06444444 Stressed 8.073457 7.994874 8.152041</span></span></code></pre>
<ul>
<li>Plot original data</li>
</ul>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">O3</span>, </span>
<span>           y <span class="op">=</span> <span class="va">log_william</span>,</span>
<span>           color <span class="op">=</span> <span class="va">Stress</span>,</span>
<span>           fill <span class="op">=</span> <span class="va">Stress</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><img src="lab_14_ANCOVA_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<ul>
<li><p>add a <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth()</a></code> layer</p></li>
<li><p>instead of using automatic calculations
(<code>method = "lm"</code>), specify <code>fit_data</code></p></li>
</ul>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">df</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">O3</span>, </span>
<span>           y <span class="op">=</span> <span class="va">log_william</span>,</span>
<span>           color <span class="op">=</span> <span class="va">Stress</span>,</span>
<span>           fill <span class="op">=</span> <span class="va">Stress</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fit_data</span>,</span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">fit</span>, </span>
<span>                  ymin <span class="op">=</span> <span class="va">lwr</span>, </span>
<span>                  ymax <span class="op">=</span> <span class="va">upr</span><span class="op">)</span>, </span>
<span>                  stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab_14_ANCOVA_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Justin Pomeranz.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
