<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lab 11: Factorial ANOVA • ENVS475</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Lab 11: Factorial ANOVA">
<meta property="og:description" content="ENVS475">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ENVS475</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2024.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/syllabus.html">
    <span class="fa fa-book"></span>
     
    Syllabus
  </a>
</li>
<li>
  <a href="../articles/schedule.html">
    <span class="fa fa-calendar"></span>
     
    Schedule
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-desktop"></span>
     
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/lectures/lecture_00/lecture_00_course_overview.html">Lecture 0: Course introduction</a>
    </li>
    <li>
      <a href="../articles/lectures/lecture_03_basic-stats/lecture_03_basic-stats.html">Lecture 03: Basic Statistics</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-laptop-code"></span>
     
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/lab_01_projects.html">lab_01_projects</a>
    </li>
    <li>
      <a href="../articles/lab_02_intro_to_R.html">lab_02_intro_to_R</a>
    </li>
    <li>
      <a href="../articles/lab_03_normal-distributions.html">lab 03: Normal Distributions</a>
    </li>
    <li>
      <a href="../articles/lab_04a_dplyr.html">lab 04a: dplyr</a>
    </li>
    <li>
      <a href="../articles/lab_04b_ggplot.html">lab_04b_ggplot</a>
    </li>
    <li>
      <a href="../articles/lab_05_point-estimates.html">lab_05_point-estimates</a>
    </li>
    <li>
      <a href="../articles/lab_06_linear-models.html">lab_06_linear-models</a>
    </li>
    <li>
      <a href="../articles/lab_07_intro_markdown.html">lab_07_intro_markdown</a>
    </li>
    <li>
      <a href="../articles/lab_08_t-tests.html">lab_08_t-tests</a>
    </li>
    <li>
      <a href="../articles/lab_10_anova.html">lab_10_anova</a>
    </li>
    <li>
      <a href="../articles/lab_11_factorial-anova.html">lab_11_factorial-anova</a>
    </li>
    <li>
      <a href="../articles/lab_12_2-way-anova.html">lab_12_2-way-anova</a>
    </li>
    <li>
      <a href="../articles/lab_13_linear-regression.html">lab_13_linear-regression</a>
    </li>
    <li>
      <a href="../articles/lab_14_ANCOVA.html">lab_14_ANCOVA</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-folder-open"></span>
     
    Homework
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/homework/HW_01.html">Homework 01 setup</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-pencil-square-o"></span>
     
    References
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/term-list.html">Terms and Definitions</a>
    </li>
  </ul>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Lab 11: Factorial ANOVA</h1>
            <h3 data-toc-skip class="subtitle">ENVS475: Experimental
Analysis and Design</h3>
            
            <h4 data-toc-skip class="date">Spring, 2023</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Jpomz/ENVS475/blob/HEAD/vignettes/articles/lab_11_factorial-anova.Rmd" class="external-link"><code>vignettes/articles/lab_11_factorial-anova.Rmd</code></a></small>
      <div class="hidden name"><code>lab_11_factorial-anova.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="about">About<a class="anchor" aria-label="anchor" href="#about"></a>
</h2>
<p>This lab will demonstrate how to perform a two-way ANOVA’s (without
interaction) in R. This includes checking assumptions, fitting the
linear model, interpreting and visualizing the results.</p>
</div>
<div class="section level2">
<h2 id="preliminaries">Preliminaries<a class="anchor" aria-label="anchor" href="#preliminaries"></a>
</h2>
<div class="section level4">
<h4 id="packages">Packages<a class="anchor" aria-label="anchor" href="#packages"></a>
</h4>
<p>For this lab, we will be using the <code>dplyr</code> and
<code>ggplot2</code> packages. Make sure both packages are installed on
your computer, and then run the following code:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h4>
<p>We will use the <code>crop_anova.csv</code> data which can be
downloaded on D2L. Load the data by running the following command:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"data/crop_anova.csv"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h2>
<p>In the previous homework, we analyzed a subset of the data and looked
for significant differences in the yield based on fertilizer type. This
time, we will keep both the plant density the fertilizer treatment to
run a factorial analysis. We will just be looking at the main effects,
and will hold off on the potential interaction effect until a future
class.</p>
<p>Let’s look at the full data, and see what the treatment levels
are.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">crop</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "density"    "block"      "fertilizer" "yield"</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">crop</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 96  4</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">crop</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   density block fertilizer    yield</span></span>
<span><span class="co">## 1     low     I    control 177.2287</span></span>
<span><span class="co">## 2     low     I    control 177.1255</span></span>
<span><span class="co">## 3     low     I    control 176.2749</span></span>
<span><span class="co">## 4     low     I    control 177.4795</span></span>
<span><span class="co">## 5     low     I    control 176.1083</span></span>
<span><span class="co">## 6     low     I    control 176.2390</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">crop</span>, <span class="va">density</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   density</span></span>
<span><span class="co">## 1     low</span></span>
<span><span class="co">## 2    high</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">crop</span>, <span class="va">fertilizer</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   fertilizer</span></span>
<span><span class="co">## 1    control</span></span>
<span><span class="co">## 2          N</span></span>
<span><span class="co">## 3          P</span></span></code></pre>
<p>For this analysis, we have two <em>factors</em> (density and
fertilizer). The <strong>Density</strong> factor has two levels: High,
and the <strong>Fertilizer</strong> factor has three levels: control, N
(Nitrogen fertilizer), and P (Phosphorous fertilizer).</p>
<p>We can also use the <code>tab()</code> function to see how many
observations are in each group:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">crop</span><span class="op">$</span><span class="va">density</span>, <span class="va">crop</span><span class="op">$</span><span class="va">fertilizer</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       </span></span>
<span><span class="co">##        control  N  P</span></span>
<span><span class="co">##   high      16 16 16</span></span>
<span><span class="co">##   low       16 16 16</span></span></code></pre>
<p>We can see that there are 16 observations in each combination of all
levels for both factors. We call this a completely balanced ANOVA
design.</p>
<div class="section level3">
<h3 id="plot-data">Plot data<a class="anchor" aria-label="anchor" href="#plot-data"></a>
</h3>
<p>Let’s start by plotting all of the data. We will save time and
consider all the grouping variables.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">crop</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fertilizer</span>,</span>
<span>           y <span class="op">=</span> <span class="va">yield</span>,</span>
<span>           color <span class="op">=</span> <span class="va">density</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab_11_factorial-anova_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>If you wanted to get a visual indication of the main effects, you
could plot the grouping variables one at a time.</p>
<ul>
<li>i.e., set both the <code>x</code> and <code>color</code> variable
above to <code>fertilizer</code> for one plot, and then change them both
to <code>density</code> for the second plot.</li>
</ul>
</div>
<div class="section level3">
<h3 id="check-pre-analysis-assumptions">Check pre-analysis assumptions<a class="anchor" aria-label="anchor" href="#check-pre-analysis-assumptions"></a>
</h3>
<div class="section level4">
<h4 id="assumption-equal-variance">Assumption: equal variance<a class="anchor" aria-label="anchor" href="#assumption-equal-variance"></a>
</h4>
<p>These data look to have approximately equal variation across the
treatment groups. The <em>“low-N”</em>, and <em>“high-P”</em> groups
look a little more narrow, but this shouldn’t be an issue.</p>
</div>
<div class="section level4">
<h4 id="assumptions-normality-of-residuals">Assumptions: Normality of residuals<a class="anchor" aria-label="anchor" href="#assumptions-normality-of-residuals"></a>
</h4>
<p>We can also check to see if the residuals are normally ditributed by
creating a QQ-plot.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">crop</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">yield</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html" class="external-link">stat_qq</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html" class="external-link">stat_qq_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab_11_factorial-anova_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<p>Most of the observations (points) fall close to the reference line.
There’s a few that are off near the low end of the data, but this should
be ok.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="factorial-anova">Factorial ANOVA<a class="anchor" aria-label="anchor" href="#factorial-anova"></a>
</h2>
<div class="section level3">
<h3 id="hypotheses-for-main-effects">Hypotheses for main effects<a class="anchor" aria-label="anchor" href="#hypotheses-for-main-effects"></a>
</h3>
<p>In a factorial ANOVA analysis (without interactions), we have a
number of main hypotheses equal to the number of factors in our design.
In this case, we have the <strong>density</strong> and the
<strong>fertilizer</strong> factor, so our hypotheses are:</p>
<div class="section level4">
<h4 id="density-main-effect-hypotheses">Density main effect hypotheses<a class="anchor" aria-label="anchor" href="#density-main-effect-hypotheses"></a>
</h4>
<p><span class="math display">\[ H0: \mu_{low} = \mu_{high}
\]</span></p>
<p><span class="math display">\[HA: \text{At least one mean is
different}\]</span></p>
</div>
<div class="section level4">
<h4 id="fertilizer-main-effect-hypotheses">Fertilizer main effect hypotheses<a class="anchor" aria-label="anchor" href="#fertilizer-main-effect-hypotheses"></a>
</h4>
<p>Null and alternative hypotheses:</p>
<p><span class="math display">\[H0: \mu_{control} = \mu_{N} =
\mu_{P}\]</span></p>
<p><span class="math display">\[HA: \text{At least one mean is
different}\]</span></p>
<p>We will discuss the null and alternative hypotheses for the
interaction later.</p>
</div>
</div>
<div class="section level3">
<h3 id="anova-with-lm">ANOVA with <code>lm()</code><a class="anchor" aria-label="anchor" href="#anova-with-lm"></a>
</h3>
<div class="section level4">
<h4 id="assumption-equal-variance-of-residuals">Assumption: Equal variance of residuals<a class="anchor" aria-label="anchor" href="#assumption-equal-variance-of-residuals"></a>
</h4>
<p>Let’s first fit a linear model to the data, and check our post-model
fit assumption with a fitted vs. residuals plot.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crop_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">yield</span> <span class="op">~</span> <span class="va">density</span> <span class="op">+</span> <span class="va">fertilizer</span>, data <span class="op">=</span> <span class="va">crop</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">crop_lm</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.fitted</span>, y <span class="op">=</span> <span class="va">.resid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>      position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitter.html" class="external-link">position_jitter</a></span><span class="op">(</span></span>
<span>        width <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>        height <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab_11_factorial-anova_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>In this plot, the absolute magnitude of the maximum and minimum
y-values are approximately the same (-1.25, 11.25), although there are a
couple of points above the 1.25 region. However, there is no clear
pattern in the spread of the points, so this looks OK.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="anova-table">ANOVA table<a class="anchor" aria-label="anchor" href="#anova-table"></a>
</h2>
<p>In order to get the statistical values for the ANOVA table, we need
to use the <code><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova()</a></code> function on the model fit object.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">crop_lm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Analysis of Variance Table</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Response: yield</span></span>
<span><span class="co">##            Df  Sum Sq Mean Sq F value    Pr(&gt;F)    </span></span>
<span><span class="co">## density     1  5.1217  5.1217 15.3162 0.0001741 ***</span></span>
<span><span class="co">## fertilizer  2  6.0680  3.0340  9.0731 0.0002533 ***</span></span>
<span><span class="co">## Residuals  92 30.7645  0.3344                      </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre>
<p>You can see that we know have a row for each of the main factors
(density, fertilizer) as well as a third row for the residuals
(unexplained variation).</p>
<p>We interpret the F-value for each factor as before, but in this case,
we can say that these are the <em>main effects</em> of that factor,
while accounting for the variation in the other factor.</p>
<p>The p-value is an indication of the likelihood of observing the data
(i.e., F-value, signal / noise ratio) we have <em>if</em> the null
hypothesis was true. In this case, both p-values are &lt; 0.002 which is
less than <span class="math inline">\(\alpha = 0.05\)</span>, and we can
conclude that there is a significant main effect for each factor.</p>
<div class="section level3">
<h3 id="plotting-main-effects-separately">PLotting main effects separately<a class="anchor" aria-label="anchor" href="#plotting-main-effects-separately"></a>
</h3>
<p>It can be helpful to plot the data considering only one factor at a
time to see the main effects.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">crop</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">fertilizer</span>,</span>
<span>           y <span class="op">=</span> <span class="va">yield</span>,</span>
<span>           color <span class="op">=</span> <span class="va">fertilizer</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab_11_factorial-anova_files/figure-html/unnamed-chunk-9-1.png" width="700">
This plot shows the average yield based on fertilizer type,
<strong>ignoring the effect</strong> of the density factor.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">crop</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">density</span>,</span>
<span>           y <span class="op">=</span> <span class="va">yield</span>,</span>
<span>           color <span class="op">=</span> <span class="va">density</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab_11_factorial-anova_files/figure-html/unnamed-chunk-10-1.png" width="700">
This plot shows the average yield based on density type,
<strong>ignoring the effect</strong> of the fertilizer factor.</p>
</div>
<div class="section level3">
<h3 id="anova-interpretation">ANOVA Interpretation<a class="anchor" aria-label="anchor" href="#anova-interpretation"></a>
</h3>
<p>Remember that the hypotheses for ANOVA are either that all means are
the same, or that at least one was different. ANOVA can only tell us
that there is a difference. Therefore, out interpretation would look
something like this:</p>
<blockquote>
<p>Based on a 2-way ANOVA (no interaction), there were significant main
effects of planting density (<span class="math inline">\(F_{1, 92}=
15.31, p &lt; 0.001\)</span>) and fertilizer addition (<span class="math inline">\(F_{2, 92}= 9.07, p &lt; 0.001\)</span>).</p>
</blockquote>
<p>In order to see <em>which</em> means are different, we can view the
summary output from the <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> model as we did before. In
this lab, I’m going to jump straight into the post-hoc Tukey HSD
test.</p>
</div>
</div>
<div class="section level2">
<h2 id="multiple-comparisons">Multiple Comparisons<a class="anchor" aria-label="anchor" href="#multiple-comparisons"></a>
</h2>
<div class="section level3">
<h3 id="tukeys-hsd">Tukey’s HSD<a class="anchor" aria-label="anchor" href="#tukeys-hsd"></a>
</h3>
<p>As mentioned above, the results of the ANOVA test indicated
significant differences. As researchers, we most likely want to know
<em>which</em> groups are different. For example, telling farmers that
density anf fertilizer are important isn’t overly helpful. Telling them
which fertilizer to use and which density to maximize their yield would
be helpful.</p>
<p>Before we run the Tukey HSD test, we need to run an ANOVA on our
linear model fit using the <code><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov()</a></code> function.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ANOVA of our lm model</span></span>
<span><span class="va">crop_aov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aov.html" class="external-link">aov</a></span><span class="op">(</span><span class="va">crop_lm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Tukey's test on the plant_aov object</span></span>
<span><span class="va">crop_tukey</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/TukeyHSD.html" class="external-link">TukeyHSD</a></span><span class="op">(</span><span class="va">crop_aov</span><span class="op">)</span></span>
<span><span class="co"># print out results</span></span>
<span><span class="va">crop_tukey</span></span></code></pre></div>
<pre><code><span><span class="co">##   Tukey multiple comparisons of means</span></span>
<span><span class="co">##     95% family-wise confidence level</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Fit: aov(formula = crop_lm)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $density</span></span>
<span><span class="co">##               diff        lwr        upr     p adj</span></span>
<span><span class="co">## low-high -0.461956 -0.6963916 -0.2275205 0.0001741</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $fertilizer</span></span>
<span><span class="co">##                 diff        lwr         upr     p adj</span></span>
<span><span class="co">## N-control  0.5991256  0.2547318  0.94351936 0.0002219</span></span>
<span><span class="co">## P-control  0.1761687 -0.1682251  0.52056252 0.4452958</span></span>
<span><span class="co">## P-N       -0.4229568 -0.7673506 -0.07856306 0.0119381</span></span></code></pre>
<p>Here, we can see that we have a section for each factor, and a row
for every pairwise combination. The table gives us an estimated and 95%
CI for the differences, as well as an adjusted p value.</p>
</div>
<div class="section level3">
<h3 id="tukey-hsd-interpretation">Tukey HSD Interpretation<a class="anchor" aria-label="anchor" href="#tukey-hsd-interpretation"></a>
</h3>
<div class="section level4">
<h4 id="density">Density<a class="anchor" aria-label="anchor" href="#density"></a>
</h4>
<p>The estimated difference in yields between low and high density is
-0.49(95%CI -0.70, -0.23), and this is a significant change (adjusted
p-value &lt; 0.001).</p>
</div>
<div class="section level4">
<h4 id="fertilizer">Fertilizer<a class="anchor" aria-label="anchor" href="#fertilizer"></a>
</h4>
<p>The interpretation for fertilizer is a bit more complex.</p>
<p>There was no significant change in yield with the addition of
Phosphorous fertilizer (95% CI of estimates change: -0.17, 0.52).
However, the addition of Nitrogen increased yield compared with no
fertilizer by 0.60 (95%CI 0.25, 0.94) kg, and the yield for N was 0.422
(95%: 0.77, 0.08) kg greater than with Phosphorous fertilizer, and both
of these differences were significant (adjusted p-values = &lt;0.001 and
0.012, respectively).</p>
<p><strong>NOTE</strong> that I switched the sign on the P-N comparison
to fit the narrative. This makes the comparison N-P.</p>
<p>We can also plot these differences. Any coefficient estimates which
cross zero are not considered to be significantly different.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">crop_tukey</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab_11_factorial-anova_files/figure-html/unnamed-chunk-12-1.png" width="700"><img src="lab_11_factorial-anova_files/figure-html/unnamed-chunk-12-2.png" width="700"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="blocking">Blocking<a class="anchor" aria-label="anchor" href="#blocking"></a>
</h2>
<p>The <code>crop_anova</code> data also includes a blocking variable.
We can include this in our analysis by adding it as a factor to our
<code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> formula. I will not go through the full process of
plotting the data and checking the assumptions here, but for a formal
analysis you should do it again including all of the grouping
variables.</p>
<p>I’m not familiar with the original design of this experiment, but
presumably the different blocks were fields when the different
treatments were randomly assigned.</p>
<div class="section level3">
<h3 id="blocking-factor-in-lm">Blocking factor in <code>lm()</code><a class="anchor" aria-label="anchor" href="#blocking-factor-in-lm"></a>
</h3>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crop_block_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">yield</span> <span class="op">~</span> <span class="va">density</span> <span class="op">+</span> <span class="va">fertilizer</span> <span class="op">+</span> <span class="va">block</span>, data <span class="op">=</span> <span class="va">crop</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">crop_block_lm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Analysis of Variance Table</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Response: yield</span></span>
<span><span class="co">##            Df  Sum Sq Mean Sq F value    Pr(&gt;F)    </span></span>
<span><span class="co">## density     1  5.1217  5.1217 15.2238 0.0001840 ***</span></span>
<span><span class="co">## fertilizer  2  6.0680  3.0340  9.0184 0.0002693 ***</span></span>
<span><span class="co">## block       2  0.4861  0.2431  0.7225 0.4883291    </span></span>
<span><span class="co">## Residuals  90 30.2784  0.3364                      </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre>
<p>Here, we can see that the blocking factor was not significant. In
other words, there was not a high degree of variation associated with
the individual block.</p>
<p>You can then continue the analysis by looking at the coefficient
estimates from the <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> model, as well as perform post-hoc
multiple comparisons, but I will skip that in this lab.</p>
<p>Note that the residual_{df}, F-values, and p-values all changed
slightly with the addition of a blocking factor. Opinions differ on how
to proceed with a non-significant blocking variable. Some say that since
it’s not significant you can drop it and re-run the analysis without it
(i.e., the analysis at the beginning of this lab). Dropping the block
will increase your degrees of freedom and can give you slightly more
statistical power.</p>
<p>Other people say that you had the block in the original design and
it’s disingenuous throw it out now, and you should keep it in the
analysis and report the lack of significance.</p>
<p>This discussion foreshadows a more complex philosophical as well as
technical concept of model selection. We most likely won’t have time to
dive into that topic in this class, but just know that there are entire
books written on when, how, and where to perform model selection.
Luckily, much of this information is also online, so if and when you
find yourself in that situation there are plenty of resources available
for you to dive in. (Or, more realistically, your boss / adviser / etc.
will probably have an opinion or a preferred method, so you will do that
for a while until you get more experience and then one day you’ll get
interested in it and go down a Wikipedia rabbit hole and come out the
other side having ordered multiple books online which you will probably
never fully read, but will still come to your own preferred method
through a combination of trial-and-error, discussions with colleagues,
and divination. Not that I’m speaking from personal experience or
anything…)</p>
<div class="section level4">
<h4 id="you-should-now-be-able-to-complete-part-of-the-homework--ill-know-more-once-i-actually-write-it-">You should now be able to complete part of the homework. I’ll know
more once I actually write it.<a class="anchor" aria-label="anchor" href="#you-should-now-be-able-to-complete-part-of-the-homework--ill-know-more-once-i-actually-write-it-"></a>
</h4>
</div>
</div>
</div>
<div class="section level2">
<h2 id="complex-blocking-designs-the-latin-square">Complex blocking designs: the Latin Square<a class="anchor" aria-label="anchor" href="#complex-blocking-designs-the-latin-square"></a>
</h2>
<p>The Latin Square is a specific design which uses two blocking factors
to control for variation. The <code>OrchardSprays</code> data we worked
with previously was a Latin Square design. We can recreate this design
visually using the <code><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix()</a></code> function.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"OrchardSprays"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">OrchardSprays</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   decrease rowpos colpos treatment</span></span>
<span><span class="co">## 1       57      1      1         D</span></span>
<span><span class="co">## 2       95      2      1         E</span></span>
<span><span class="co">## 3        8      3      1         B</span></span>
<span><span class="co">## 4       69      4      1         H</span></span>
<span><span class="co">## 5       92      5      1         G</span></span>
<span><span class="co">## 6       90      6      1         F</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">OrchardSprays</span><span class="op">$</span><span class="va">treatment</span>, <span class="fl">8</span>, <span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]</span></span>
<span><span class="co">## [1,] "D"  "C"  "F"  "H"  "E"  "A"  "B"  "G" </span></span>
<span><span class="co">## [2,] "E"  "B"  "H"  "A"  "D"  "C"  "G"  "F" </span></span>
<span><span class="co">## [3,] "B"  "H"  "A"  "E"  "G"  "F"  "C"  "D" </span></span>
<span><span class="co">## [4,] "H"  "D"  "E"  "C"  "A"  "G"  "F"  "B" </span></span>
<span><span class="co">## [5,] "G"  "E"  "D"  "F"  "C"  "B"  "A"  "H" </span></span>
<span><span class="co">## [6,] "F"  "A"  "C"  "G"  "B"  "D"  "H"  "E" </span></span>
<span><span class="co">## [7,] "C"  "F"  "G"  "B"  "H"  "E"  "D"  "A" </span></span>
<span><span class="co">## [8,] "A"  "G"  "B"  "D"  "F"  "H"  "E"  "C"</span></span></code></pre>
<p>We can see that each row and column has the letters A-H in it exactly
once. In this instance, the design was to control for variability in
space (N-S, E-W) across a large agricultural field setting, but the rows
and columns could also be specific treatment levels.</p>
<p>For example, in the homework data set, each row is a different
fertilizer treatment, each column is a different tillage treatment, and
then each unique position of row and column is a different seed
variety.</p>
<pre><code><span><span class="co">##         treatA treatB treatC treatD treatE</span></span>
<span><span class="co">## fertil1 "A"    "C"    "B"    "D"    "E"   </span></span>
<span><span class="co">## fertil2 "E"    "B"    "C"    "A"    "D"   </span></span>
<span><span class="co">## fertil3 "C"    "A"    "D"    "E"    "B"   </span></span>
<span><span class="co">## fertil4 "B"    "D"    "E"    "C"    "A"   </span></span>
<span><span class="co">## fertil5 "D"    "E"    "A"    "B"    "C"</span></span></code></pre>
<div class="section level3">
<h3 id="data-wrangling">Data wrangling<a class="anchor" aria-label="anchor" href="#data-wrangling"></a>
</h3>
<div class="section level4">
<h4 id="change-blocking-variables-to-factors">Change blocking variables to <code>factors</code><a class="anchor" aria-label="anchor" href="#change-blocking-variables-to-factors"></a>
</h4>
<p>You may have noticed that the row and column position variable is
described with a number, and R will interpret this as a continuous
variable:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">OrchardSprays</span><span class="op">$</span><span class="va">rowpos</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "numeric"</span></span></code></pre>
<p>We want R to treat these blocking variables as different groups
(called factors in R-speak), not as a continuous variable. To do that,
we can use our old friend <code>mutate</code>. In the following code, we
will make new variables for <code>rowpos</code> and <code>colpos</code>,
and add <code>_f</code> to the end of the name to indicate that they are
now “factors”.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">os</span> <span class="op">&lt;-</span> <span class="va">OrchardSprays</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>rowpos_f <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">rowpos</span><span class="op">)</span>,</span>
<span>         colpos_f <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">colpos</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">os</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   decrease rowpos colpos treatment rowpos_f colpos_f</span></span>
<span><span class="co">## 1       57      1      1         D        1        1</span></span>
<span><span class="co">## 2       95      2      1         E        2        1</span></span>
<span><span class="co">## 3        8      3      1         B        3        1</span></span>
<span><span class="co">## 4       69      4      1         H        4        1</span></span>
<span><span class="co">## 5       92      5      1         G        5        1</span></span>
<span><span class="co">## 6       90      6      1         F        6        1</span></span></code></pre>
<p>This is a good opportunity to remind you all to think about how
you’re going to analyze your data <em>before</em> you enter it. If you
know your going to be running an ANOVA or some other type of categorical
analysis, enter row position as “r1” instead of 1. Likewise, column
position 2 could be “c2”. This way, when you load your data into R, it
automatically treats it as a categorical variable, and then you don’t
have to mess around with changing the class of the variable. (It will
also prevent you from running a full analysis, interpreting the results
and writing it up, only to find out that your blocking variables are
continuous instead of categorical. This is exactly what just happened to
me as I was writing this lab exercise.)</p>
</div>
<div class="section level4">
<h4 id="transform-response-variable">Transform response variable<a class="anchor" aria-label="anchor" href="#transform-response-variable"></a>
</h4>
<div class="section level5">
<h5 id="skip-this-in-week-11">Skip this in week 11<a class="anchor" aria-label="anchor" href="#skip-this-in-week-11"></a>
</h5>
<p>You may recall from the homework that the <code>OrchardSprays</code>
data failed its assumption checks. There are a few options for you to do
when this occurs. I’m hoping to go through them in more detail later,
but for now, suffice it to say that we can transform the variable to see
if that fixes our problems. A common transformation is a
log-transformation.</p>
</div>
</div>
<div class="section level4">
<h4 id="log-transformation">Log transformation<a class="anchor" aria-label="anchor" href="#log-transformation"></a>
</h4>
<p>The following code takes the natural logarithm (<code><a href="https://rdrr.io/r/base/Log.html" class="external-link">log()</a></code>)
of the response variable, <code>decrease</code> and saves it in a new
variable.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">os_transform</span> <span class="op">&lt;-</span> <span class="va">os</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>l_decrease <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">decrease</span> <span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">os_transform</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   decrease rowpos colpos treatment rowpos_f colpos_f l_decrease</span></span>
<span><span class="co">## 1       57      1      1         D        1        1   4.060443</span></span>
<span><span class="co">## 2       95      2      1         E        2        1   4.564348</span></span>
<span><span class="co">## 3        8      3      1         B        3        1   2.197225</span></span>
<span><span class="co">## 4       69      4      1         H        4        1   4.248495</span></span>
<span><span class="co">## 5       92      5      1         G        5        1   4.532599</span></span>
<span><span class="co">## 6       90      6      1         F        6        1   4.510860</span></span></code></pre>
<p>Let’s quickly check the assumptions again to see if this
transformation fixed the problems.</p>
</div>
<div class="section level4">
<h4 id="grouped-box-plots-normal-variance">Grouped-box plots: Normal variance<a class="anchor" aria-label="anchor" href="#grouped-box-plots-normal-variance"></a>
</h4>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">os_transform</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">treatment</span>, </span>
<span>           y <span class="op">=</span> <span class="va">l_decrease</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitter.html" class="external-link">position_jitter</a></span><span class="op">(</span></span>
<span>    width <span class="op">=</span> <span class="fl">0.05</span></span>
<span>  <span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p><img src="lab_11_factorial-anova_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<p>Variance between groups looks much more equal the “G” group is a
little small, but looks much better than before.</p>
</div>
<div class="section level4">
<h4 id="qqplot-normality-of-residuals">QQplot: Normality of residuals<a class="anchor" aria-label="anchor" href="#qqplot-normality-of-residuals"></a>
</h4>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">os_transform</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>sample <span class="op">=</span> <span class="va">l_decrease</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html" class="external-link">stat_qq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co"># plot qq points</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_qq.html" class="external-link">stat_qq_line</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># reference line</span></span></code></pre></div>
<p><img src="lab_11_factorial-anova_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<p>This still doesn’t look ideal, but linear model analyses are fairly
robust to this assumption, so it’s probably OK.</p>
</div>
<div class="section level4">
<h4 id="fit-the-model">Fit the model<a class="anchor" aria-label="anchor" href="#fit-the-model"></a>
</h4>
<p>In the modified <code>os</code> data, the blocking factors are
indicated by the <code>rowpos_f</code> and <code>colpos_f</code>
variables. The level of pesticide is indicated by the
<code>treatment</code> level, and the transformed response variable is
the <code>l_decrease</code> variable (measuring the decline in bee
numbers). We can incorporate this into an <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> analysis by
adding more predictor variables.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">os_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">l_decrease</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">+</span> <span class="va">rowpos_f</span> <span class="op">+</span> <span class="va">colpos_f</span>, data <span class="op">=</span> <span class="va">os_transform</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="fitted-vs--redisual-equal-variance-of-residuals">Fitted Vs. Redisual: Equal variance of residuals<a class="anchor" aria-label="anchor" href="#fitted-vs--redisual-equal-variance-of-residuals"></a>
</h4>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">os_lm</span>,</span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.fitted</span>, y <span class="op">=</span> <span class="va">.resid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>    position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitter.html" class="external-link">position_jitter</a></span><span class="op">(</span></span>
<span>      width <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p><img src="lab_11_factorial-anova_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
<p>Once again, not perfect, but looks much better than it did
before.</p>
</div>
<div class="section level4">
<h4 id="continuing-the-analysis">Continuing the analysis<a class="anchor" aria-label="anchor" href="#continuing-the-analysis"></a>
</h4>
<p>Now, we can run the same analysis as normal, but we will use the new
data object <code>os_transform</code> and the new variable
<code>l_decrease</code> in our function calls.</p>
</div>
</div>
<div class="section level3">
<h3 id="anova-with-two-blocking-factors">ANOVA with two blocking factors<a class="anchor" aria-label="anchor" href="#anova-with-two-blocking-factors"></a>
</h3>
<p>For this analysis, we have three factors, each of which has 2 or more
levels:</p>
<ul>
<li>treatment factor: Levels A-H.<br>
</li>
<li>Row position factor: Levels 1-8<br>
</li>
<li>Col position factor: Levels 1-8</li>
</ul>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">os_lm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Analysis of Variance Table</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Response: l_decrease</span></span>
<span><span class="co">##           Df Sum Sq Mean Sq F value  Pr(&gt;F)    </span></span>
<span><span class="co">## treatment  7 62.904  8.9862 51.5196 &lt; 2e-16 ***</span></span>
<span><span class="co">## rowpos_f   7  2.768  0.3955  2.2672 0.04726 *  </span></span>
<span><span class="co">## colpos_f   7  0.850  0.1214  0.6960 0.67498    </span></span>
<span><span class="co">## Residuals 42  7.326  0.1744                    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre>
<p>Here, we find that there was a significant main effect of treatment
(<span class="math inline">\(F_{7, 42} = 51.52, p &lt; 0.001\)</span>).
This means that the decrease in bees did change based on herbicide
treatment level.</p>
<p>We also found a significant main effect of row position (<span class="math inline">\(F_{7, 42} = 2.27, p &lt; 0.05\)</span>). This
means that the decrease in bees did change just based on the row that
the data was collected in. In other words, the number of bees varied
across the experimental field <em>independent of the
treatments</em>.</p>
<p>It’s worth noting that despite this finding, the effect of treatment
was still noticeable, and the results reported above are accounting for
the differences in row position. Another way of saying this is that the
effect of treatment was significant <em>while controlling for the effect
of row position</em>.</p>
<p>As an example, we can run the analysis without the
<code>rowpos_f</code> variable.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">os_lm_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">l_decrease</span> <span class="op">~</span> <span class="va">treatment</span> <span class="op">+</span>  <span class="va">colpos_f</span>, data <span class="op">=</span> <span class="va">os_transform</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">os_lm_2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Analysis of Variance Table</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Response: l_decrease</span></span>
<span><span class="co">##           Df Sum Sq Mean Sq F value Pr(&gt;F)    </span></span>
<span><span class="co">## treatment  7 62.904  8.9862 43.6227 &lt;2e-16 ***</span></span>
<span><span class="co">## colpos_f   7  0.850  0.1214  0.5893 0.7613    </span></span>
<span><span class="co">## Residuals 49 10.094  0.2060                   </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre>
<p>The overall conclusions from our second model did not change.
However, if you look closely at the output of our second model, you will
notice that the F-value is <em>lower</em> in the second model, even
though we have more degrees of freedom (and hence, more statistical
power) since we have one fewer predictor variables. In this case, the
F-value is still so high that our results are highly significant, but
this lower F-value means that we are explaining less of the variation in
the data.</p>
<p>Another way of showing this is the adjusted R<sup>2</sup> value from
out <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> output.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># full model, with rowpos_f blocking</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">os_lm</span><span class="op">)</span><span class="op">$</span><span class="va">adj.r.square</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.8511974</span></span></code></pre>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># second model, without rowpos_F blocking</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">os_lm_2</span><span class="op">)</span><span class="op">$</span><span class="va">adj.r.square</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.82426</span></span></code></pre>
<p>Again, the differences here are not striking and the overall
conclusions are the same. However, the second model explains less of the
variation, indicated by a lower Adjusted R<sup>2</sup> value. Including
the <code>rowpos_F</code> block in the analysis explains more of the
variation than ignoring it.</p>
<p>There are situations where including a grouping variable can explain
enough of the variation that the main effect of other factors goes from
insignificant to significant (this might happen in your homework,
<em>wink wink</em>).</p>
<p>Again, this brings up interesting questions about model selection,
which we will leave unanswered for the time being.</p>
<div class="section level4">
<h4 id="coda">Coda<a class="anchor" aria-label="anchor" href="#coda"></a>
</h4>
<p>This concludes Lab 11, and you should now be able to complete the
homework assignment.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Justin Pomeranz.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
